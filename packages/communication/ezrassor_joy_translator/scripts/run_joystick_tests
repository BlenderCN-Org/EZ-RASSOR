#!/bin/sh

TEMPORARY_DIR="$1"
JOYSTICKS="$(ls /dev/input | grep 'js.')"

if ! [ "$(id -u)" -eq "0" ]; then
    printf "This script must be run as root.\n"
    exit 1
fi

rm -rf "$TEMPORARY_DIR"
mkdir -p "$TEMPORARY_DIR"
sleep 1

printf "\nStart pressing buttons!\n"
for STICK in $JOYSTICKS; do
    jstest --event "/dev/input/$STICK" 1> "$TEMPORARY_DIR/$STICK" &
done
for TIMESTEP in 1 2 3 4 5 6 7 8; do
    sleep 0.5
    printf "."
done
printf "\n"

pkill jstest
printf "\nTests complete!\n"
