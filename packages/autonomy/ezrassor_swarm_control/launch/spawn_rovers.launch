<?xml version="1.0" encoding="UTF-8"?>
<!-- Launch a Gazebo simulation which demonstrates a swarm of EZ-RASSORs collaborating to mine regolith
     Written by Daniel Silva. -->

<launch>
  <arg name="robot_count" default="2"/>
  <arg name="spawn_x_coords" default="default"/>
  <arg name="spawn_y_coords" default="default"/>
  <arg name="spawn_z_coords" default="default"/>
  <arg name="enable_cameras" default="default"/>
  <arg name="enable_real_odometry" default="default"/>

  <!-- Launch a rover's communication system -->
  <group ns="ezrassor$(arg robot_count)">
    <include file="$(find ezrassor_launcher)/launch/configurable_communication.launch">
      <arg name="control_methods" value="autonomy"/>
      <arg name="enable_cameras" value="$(arg enable_cameras)"/>
      <arg name="enable_real_odometry" value="$(arg enable_real_odometry)"/>
    </include>

    <!-- Spawn the rover's model. -->
    <include file="$(find ezrassor_sim_description)/launch/model.launch">
      <arg name="model_id" value="$(arg robot_count)"/>
      <arg name="spawn_x_coord"
           value="$(eval str(spawn_x_coords).split()[robot_count - 1])"
           unless="$(eval spawn_x_coords == 'default')"/>
      <arg name="spawn_y_coord"
           value="$(eval str(spawn_y_coords).split()[robot_count - 1])"
           unless="$(eval spawn_y_coords == 'default')"/>
      <arg name="spawn_z_coord"
           value="$(eval str(spawn_z_coords).split()[robot_count - 1])"
           unless="$(eval spawn_z_coords == 'default')"/>
    </include>

    <!-- Launch the rover's control nodes. -->
    <include file="$(find ezrassor_sim_control)/launch/model_controls.launch"/>
  </group>

  <!-- Recursively spawn remaining rovers -->
  <include file="$(find ezrassor_launcher)/launch/spawn_rovers.launch"
           unless="$(eval robot_count == 1)">
    <arg name="robot_count" value="$(eval robot_count - 1)"/>
    <arg name="spawn_x_coords" value="$(arg spawn_x_coords)"/>
    <arg name="spawn_y_coords" value="$(arg spawn_y_coords)"/>
    <arg name="spawn_z_coords" value="$(arg spawn_z_coords)"/>
  </include>
</launch>
