<?xml version="1.0" encoding="UTF-8"?>
<!-- Launch autonomous control for the EZ-RASSOR.
     Written by Cameron Taylor and Tiger Sachse. -->
<launch>
  <arg name="wheel_instructions_topic"/>
  <arg name="front_arm_instructions_topic"/>
  <arg name="back_arm_instructions_topic"/>
  <arg name="front_drum_instructions_topic"/>
  <arg name="back_drum_instructions_topic"/>
  <arg name="digsite_x_coord" default="10"/>
  <arg name="digsite_y_coord" default="10"/>
  <arg name="max_linear_velocity" default="1"/>
  <arg name="max_angular_velocity" default="1"/>
  <arg name="enable_cameras" default="true"/>
  <arg name="enable_real_odometry" default="false"/>

  <!-- Launch the autonomous control node. -->
  <node pkg="ezrassor_autonomous_control"
        name="autonomous_control"
        type="autonomous_control"
        output="screen">
    <param name="digsite_x_coord" value="$(arg digsite_x_coord)"/>
    <param name="digsite_y_coord" value="$(arg digsite_y_coord)"/>
    <param name="max_linear_velocity" value="$(arg max_linear_velocity)"/>
    <param name="max_angular_velocity" value="$(arg max_angular_velocity)"/>
    <param name="enable_real_odometry" value="$(arg enable_real_odometry)"/>
    <param name="wheel_instructions_topic"
           value="$(arg wheel_instructions_topic)"/>
    <param name="front_arm_instructions_topic"
           value="$(arg front_arm_instructions_topic)"/>
    <param name="back_arm_instructions_topic"
           value="$(arg back_arm_instructions_topic)"/>
    <param name="front_drum_instructions_topic"
           value="$(arg front_drum_instructions_topic)"/>
    <param name="back_drum_instructions_topic"
           value="$(arg back_drum_instructions_topic)"/>
  </node>

  <group if="$(arg enable_cameras)">
    <node pkg="image_view" type="image_view" name="image_view">
      <remap from="image" to="depth/image_raw"/>
    </node>

    <node pkg="depthimage_to_laserscan" type="depthimage_to_laserscan"
          name="depthimage_to_laserscan">
      <remap from="image" to="depth/image_raw"/>
      <remap from="camera_info" to="depth/camera_info"/>
    </node>

	<node pkg="imu_complementary_filter" type="complementary_filter_node"
		name="complementary_filter_node">
		<remap from="imu/data_raw" to="imu"/>
	</node>

	<node pkg="robot_localization" type="ekf_localization_node" name="ekf_se" clear_params="true">
		<rosparam command="load" file="$(find ezrassor_autonomous_control)/launch/ekf_template.yaml" />
	</node>

    <node pkg="ezrassor_autonomous_control"
          type="depth_estimator"
          name="depth_estimator"/>

    <node pkg="ezrassor_autonomous_control"
          type="transform_broadcaster"
          name="transform_broadcaster"/>
  </group>
</launch>
